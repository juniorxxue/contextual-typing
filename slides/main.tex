\documentclass[compress,9pt,aspectratio=169]{beamer}

\usepackage{mathpartir}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{listings}

\usepackage{cancel}

\usepackage{comment}

\usetheme[frameno,sans]{Arguelles}

\title{Contextual Type Inference}

\author{Xu Xue}

\begin{document}

\frame[plain]{\titlepage}

\begin{frame} 
\tableofcontents
\end{frame}

\section{Declarative System}

\begin{frame}{Syntax}

\begin{align*}
&\text{Types} \quad\quad &A, B ::=&~ \mathtt{Int} \mid \mathtt{Top} \mid A \rightarrow B\\
&\text{Expressions} \quad \quad &e::=&~ x \mid \lambda x . ~e \mid e_1~e_2 \mid e : A\\
&\text{Contexts} \quad\quad &\Gamma::=&~ . \mid \Gamma, x : A
\end{align*}

\end{frame}

\begin{frame}{Bidirectional Typing: \boxed{\Gamma \vdash e \Leftrightarrow A}}
\begin{mathpar}
\inferrule*[lab=T-Lit]
{ }
{\Gamma \vdash n \Rightarrow Int}

\inferrule*[lab=T-Var]
{x : A \in \Gamma}
{\Gamma \vdash x \Rightarrow A}

\inferrule*[lab=T-Lam]
{\Gamma, x : A \vdash e \Leftarrow B}
{\Gamma \vdash \lambda x.~e \Leftarrow A \rightarrow B}

\inferrule*[lab=T-App1]
{\Gamma \vdash e_1 \Rightarrow A \rightarrow B \\
 \Gamma \vdash e_2 \Leftarrow A}
{\Gamma \vdash e_1~e_2 \Rightarrow B}

\inferrule*[lab=T-App2]
{\Gamma \vdash e_1 \Leftarrow A \rightarrow B \\
 \Gamma \vdash e_2 \Rightarrow A}
{\Gamma \vdash e_1~e_2 \Rightarrow B}

\inferrule*[lab=T-Ann]
{\Gamma \vdash e \Leftarrow A}
{\Gamma \vdash e : A \Rightarrow A}

\inferrule*[lab=T-Sub]
{\Gamma \vdash e \Rightarrow B \\ B <: A}
{\Gamma \vdash e \Leftarrow A}
\end{mathpar}
\end{frame}

\begin{frame}{Subtyping: \boxed{A <: B}}
\begin{mathpar}
\inferrule*[lab=S-Int]
{ }
{Int <: Int}

\inferrule*[lab=S-Top]
{ }
{A <: Top}

\inferrule*[lab=S-Arr]
{C <: A \\ B <: D}
{A \rightarrow B <: C \rightarrow D}
\end{mathpar}
    
\end{frame}

\include{chapters/experimental.tex}
\include{chapters/sound.tex}

\section{Cases}

\begin{frame}{$(\lambda x. ~x)~1$}
\begin{mathpar}
\inferrule*[Right=T-App]
{
\inferrule*[Right=T-Lam1]
{. \vdash Top \Rightarrow 1 \Rightarrow Int \\ x : Int \vdash Top \Rightarrow x \Rightarrow Int}
{. \vdash \boxed{1} \rightarrow Top \Rightarrow \lambda x. ~x \Rightarrow Int \rightarrow Int}
}
{. \vdash Top \Rightarrow (\lambda x. ~x)~1 \Rightarrow Int}
\end{mathpar}
\end{frame}

\begin{frame}{$(\lambda f . ~ f ~ 1) : ((Int \rightarrow Int) \rightarrow Int)~ (\lambda x. ~x)$}

\begin{mathpar}
\inferrule*[Right=T-App]
%%%%%% T-App Premise
{
\inferrule*[Right=T-Ann]
{
\inferrule*[Right=T-Lam2]{ }{. \vdash (Int \rightarrow Int) \rightarrow Int \Rightarrow \lambda f . ~ f ~ 1 \Rightarrow (Int \rightarrow Int) \rightarrow Int} \quad \quad \quad \quad
\inferrule*[Right=S-Arr]{ }{. \vdash (Int \rightarrow Int) \rightarrow Int <: \boxed{\lambda x. ~x} \rightarrow Top}
}
{. \vdash \boxed{\lambda x. ~x} \rightarrow Top \Rightarrow (\lambda f . ~ f ~ 1) : ((Int \rightarrow Int) \rightarrow Int) \Rightarrow (Int \rightarrow Int) \rightarrow Int}
}
%%%%%% T-App Conclusion
{. \vdash Top \Rightarrow (\lambda f . ~ f ~ 1) : ((Int \rightarrow Int) \rightarrow Int)~ (\lambda x. ~x) \Rightarrow Int}
\end{mathpar}

For the second premise, we have

\begin{mathpar}
\inferrule*[Right=S-Arr]
{
\inferrule*[Right=S-Tele]
{. \vdash Int \rightarrow Int \Rightarrow \lambda x. ~x \Rightarrow Int \rightarrow Int}
{ . \vdash \boxed{\lambda x. ~x} <: Int \rightarrow Int} \\
. \vdash Int <: Top
}
{. \vdash (Int \rightarrow Int) \rightarrow Int <: \boxed{\lambda x. ~x} \rightarrow Top}
\end{mathpar}
	
\end{frame}

\end{document}
