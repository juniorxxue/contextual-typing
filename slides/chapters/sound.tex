\section{Soundness}

\begin{frame}{Soundness}

\begin{lemma}[Soundness]
If $\Gamma \vdash H \Rightarrow e \Rightarrow A$ and  $(H, A) \rightarrowtail (\bar{e}, T, A')$, then $\Gamma \vdash e \vartriangleright \bar{e} \Leftarrow A'$.
\end{lemma}

\begin{proof}
Induction on \cancel{algo typing} split.
\end{proof}
\end{frame}

\begin{frame}{Proof of Soundness}

\textbf{case none: $\Gamma \vdash B \Rightarrow e \Rightarrow A$}
\begin{itemize}
	\item goal: $\Gamma \vdash e \Leftarrow A$
\end{itemize}

\noindent\makebox[\linewidth]{\rule{0.9\paperwidth}{0.4pt}}
 % ------------------------------------------------------
 
 \textbf{case have: $\Gamma \vdash H \Rightarrow x \Rightarrow A$}
 
\begin{itemize}
	\item if $H$ is $\boxed{e} \mapsto H'$; we have $\Gamma \vdash \boxed{e} \mapsto H' \Rightarrow x \Rightarrow B \rightarrow C$ and $(\boxed{e} \mapsto H', B \rightarrow C)\rightarrowtail (\bar{e}, T, A')$;
	\item destruct the split; we have $(H', C)  \rightarrowtail (\bar{e}', T, A')$;
	\item the goal is $\Gamma \vdash x \triangleright \bar{e} \Leftarrow A'$;
	\item we know that $\bar{e}$ is $e :: \bar{e}'$; that is we just prove $\Gamma \vdash x \triangleright (e :: \bar{e}') \Leftarrow A'$; that is also $\Gamma \vdash x~e \triangleright \bar{e}' \Leftarrow A'$;
\end{itemize}

\end{frame}


% #region [rgba(0,196,25,0.15)]
\section{Completeness}

\begin{frame}{Completeness}

I think the main issues are around the rule T-App2: For example, $(\lambda x . ~x)~1$.

\begin{mathpar}
\inferrule*[lab=T-App2]
{\Gamma \vdash e_1 \Leftarrow A \rightarrow B \\
 \Gamma \vdash e_2 \Rightarrow A}
{\Gamma \vdash e_1~e_2 \Rightarrow B}

\inferrule*[lab=T-App2]
{\Gamma \vdash \lambda x. ~x \Leftarrow Int \rightarrow Top \\
 \Gamma \vdash 1 \Rightarrow Int}
{\Gamma \vdash (\lambda x . ~x)~1 \Rightarrow Top}
\end{mathpar}

The $B$ in rule T-App2 is too relaxed; we may include a \emph{minimal typing}.

\begin{lemma}[Completeness (Inf)]
If $\Gamma \vdash e \Rightarrow A$, then $\exists B, \Gamma \vdash Top \Rightarrow e \Rightarrow B$ and $\Gamma \vdash B <: A$.
\end{lemma}

\begin{lemma}[Completeness (Chk)]
If $\Gamma \vdash e \Leftarrow A$, then $\exists B, \Gamma \vdash A \Rightarrow e \Rightarrow B$ and $\Gamma \vdash B <: A$.
\end{lemma}

\end{frame}
%end region

\begin{frame}{Completeness (Gen)}
\begin{theorem}[Completeness]
If $\Gamma \vdash e \Leftrightarrow A$, then $\exists B, \Gamma \vdash (f \Leftrightarrow A) \Rightarrow e \Rightarrow B$ and $\Gamma \vdash B <: A$.
\begin{align*}
f \Leftarrow  A = & ~A \\
f \Rightarrow A  =& ~Top
\end{align*}
\begin{proof}
Induction on $\Gamma \vdash e \Leftrightarrow A$;
\end{proof}
\end{theorem}
Note: we can further simplify the theorem (check condition) If we have the property that
\begin{lemma}[Typing Implies Subtyping]
If $\Gamma \vdash A \Rightarrow e \Rightarrow B$, then $\Gamma \vdash B <: A$.
\end{lemma}
\end{frame}

\begin{frame}{Main issues}

\begin{mathpar}
\inferrule*[Right=T-App2]
{\emptyset \vdash \lambda x. ~(\lambda y. ~y) \Leftarrow Int \rightarrow (Int \rightarrow Int) \\ \emptyset \vdash 1 \Rightarrow Int}
{\emptyset \vdash (\lambda x. ~(\lambda y. ~y))~1 \Rightarrow Int \rightarrow Int}
\end{mathpar}

\begin{mathpar}
\inferrule*[Right=T-App]
{
\inferrule*[Right=T-Lam1]
{\emptyset \vdash Top \Rightarrow 1 \Rightarrow Int \\
 x : Int ~\cancel{\vdash} Top \Rightarrow (\lambda y. ~y) \Rightarrow Int \rightarrow Int}
{\emptyset ~\cancel{\vdash} \boxed{1} \mapsto Top \Rightarrow \lambda x. ~(\lambda y. ~y) \Rightarrow Int \rightarrow Int}
}
{\emptyset ~\cancel{\vdash} Top \Rightarrow (\lambda x. ~(\lambda y. ~y))~1 \Rightarrow Int \rightarrow Int}	
\end{mathpar}


\end{frame}