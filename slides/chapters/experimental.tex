\section{Algo Sys}

\begin{frame}{Syntax \footnote{We reserve $A, B, C, D$ for normal types, and $H$ for hints}}
\begin{align*}
&\text{Hints}\quad\quad &H ::=&~ A \mid \boxed{e} \mapsto H\\
&\text{Normal Types} \quad\quad &A, B ::=&~ \mathtt{Int} \mid \mathtt{Top} \mid A \rightarrow B
\end{align*}

I'm trying to think could it have something like
$$
\boxed{e} \rightarrow A \rightarrow \boxed{e} \rightarrow ... or \quad A \rightarrow \boxed{e} \rightarrow ...
$$

I don't think so, since there're several ways to modify the hint

\begin{itemize}
	\item Lambda, only eliminate the head
	\item Ann, replace the whole hint with a normal type (annotation)
	\item App, chain/append a hole on top of a hint
\end{itemize}


\end{frame}

\begin{frame}{Typing: \boxed{\Gamma \vdash H \Rightarrow e \Rightarrow A}}
\begin{mathpar}
\small
\inferrule*[lab=T-Lit]
{\Gamma \vdash \mathtt{Int} <: H}
{\Gamma \vdash H \Rightarrow i \Rightarrow \mathsf{Int}}

\inferrule*[lab=T-Var]
{x : A \in \Gamma \\
 \Gamma \vdash A <: H}
{\Gamma \vdash H \Rightarrow x \Rightarrow A}

\inferrule*[lab=T-App]
{\Gamma \vdash \boxed{e_2} \mapsto H \Rightarrow e_1 \Rightarrow A \rightarrow B}
{\Gamma \vdash H \Rightarrow e_1~e_2 \Rightarrow B}

\inferrule*[lab=T-Ann]
{\Gamma \vdash A \Rightarrow e \Rightarrow B \\
 \Gamma \vdash A <: H}
{\Gamma \vdash H \Rightarrow e : A \Rightarrow A}

\inferrule*[lab=T-Lam1]
{\Gamma \vdash \mathtt{Top} \Rightarrow e_1 \Rightarrow A \\
 \Gamma, x : A \vdash H \Rightarrow e \Rightarrow B}
{\Gamma \vdash \boxed{e_1} \mapsto H \Rightarrow \lambda x.~e \Rightarrow A \rightarrow B}

\inferrule*[lab=T-Lam2]
{\Gamma, x : A \vdash B \Rightarrow e \Rightarrow C}
{\Gamma \vdash A \rightarrow B \Rightarrow \lambda x.~e \Rightarrow A \rightarrow C}
\end{mathpar} 
\end{frame}

\begin{frame}{Subtyping: \boxed{\Gamma \vdash A <: H}}
\begin{mathpar}
\inferrule*[lab=S-Refl]	
{ }
{\Gamma \vdash \mathtt{Int} <: \mathtt{Int}}

\inferrule*[lab=S-Top]
{ }
{\Gamma \vdash A <: \mathtt{Top}}

\inferrule*[lab=S-Arr]
{\Gamma \vdash C <: A \\
 \Gamma \vdash B <: D}
{\Gamma \vdash A \rightarrow B <: C \rightarrow D}

\inferrule*[lab=S-Chain]
{\Gamma \vdash A \Rightarrow e \Rightarrow C	 \\
 \Gamma \vdash B <: H}
{\Gamma \vdash A \rightarrow B <: \boxed{e} \mapsto H}
\end{mathpar}    
\end{frame}

\begin{frame}{Split: \boxed{(H , A) \rightarrowtail (\bar{e} , T, A')}\footnote{Observation: we know that $\Gamma \vdash \boxed{e} \mapsto H \Rightarrow e \Rightarrow A \rightarrow B$ is always true, thus it covers all cases.}}
\begin{mathpar}
\inferrule*[lab=none]	
{ }
{(T, A) \rightarrowtail ([], T, A)}

\inferrule*[lab=have]
{(H, B) \rightarrowtail (\bar{e}, T', B')}
{(\boxed{e} \mapsto H,  (A \rightarrow B)) \rightarrowtail (e :: \bar{e}, T', B')}
\end{mathpar}
\end{frame}

\begin{frame}{Applications: $e \triangleright \bar{e} = e'$}

\begin{mathpar}
\inferrule*[lab=empty]
{ }
{e \triangleright [] = e}

\inferrule*[lab=cons]
{ }
{e_1 \triangleright (e_2 :: \bar{e}) = (e_1~e_2) :: \bar{e}}

\end{mathpar}
\end{frame}

\begin{frame}{Transform Lemma}
\begin{lemma}[Transform]
If $\Gamma \vdash H \Rightarrow e \Rightarrow A$ and $(H, A) \rightarrowtail (\bar{e}, T, A')$, then $\Gamma \vdash T \Rightarrow e \triangleright \bar{e} \Rightarrow A'$.
\end{lemma}

\begin{lemma}[Split]
If $\Gamma \vdash H \Rightarrow e \Rightarrow A$, then $\exists (\bar{e}, T, A'), (H , A) \rightarrowtail (\bar{e} , T, A')$.
\end{lemma}

\end{frame}

\begin{frame}{Properties of Algo.}
\begin{lemma}[Typing implies Subtyping]
If $\Gamma \vdash H \Rightarrow e \Rightarrow A$ then $\Gamma \vdash A <: H$.
\end{lemma}

\begin{lemma}[Hint Self]
If $\Gamma \vdash H \Rightarrow e \Rightarrow A$, then $\Gamma \vdash A \Rightarrow e \Rightarrow A$.
\end{lemma}
\end{frame}
